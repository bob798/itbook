# 数据仓库中间构建过程的总结

最近在【大客户合同数据仓库中间层构建】这个项目里面，业务PD、应用研发、数仓研发共同努力构建了一个不错的数据中间层。

我总结一下在构建数据仓库中间层的过程中的参与者、构建的流程以及一些交付物。目的是为了以后同样的构建数据仓库中间层的


### 业务PD的职责和交付物

#### 职责
1. 向应用开发和数据开发的同学介绍相关的业务进行介绍、说明业务规则。
2. 统一业务概念和业务术语

#### 输出的交付物
1. 业务术语的定义 
2. 业务介绍文档

 


### 应用研发的职责以及交付物
1. 提供业务领域模型。用UML类图做为领域对象定义的标准语言，来定义业务对象的属性以及业务对象之间的关联。
2. 物理数据源的ER图。应用研发通常使用数据库或者NOSQL做为自己的数据源，可以使用ER图说明数据库的设计。我们的数据表结构在IDB上都能找到定义，但表直接的关系在IDB上是没有的。所以，我们我们需要用文档的形式体现我们的数据表直接的关系。这部分就需要应用研发团队能输出的表关系以及表结构的定义（这部分可以连接到IDB）
3. 以文档的形式说明业务对象和数据表的映射关系或者说取数逻辑。举例来说，卖家和买家是两个业务对象。这个两个对象都是在一张表里面，通过Type这个字段的枚举值来区分的。所以，就要明确卖家和买家的取数逻辑（SQL），例如Buyer:selct * from users where type='buyer'
4. 应用研发负责就讲数据源输出到数仓的ods层。ods层接纳原始的数据源数据，没有具体的命名规范，保持和业务系统一致就可以了。


### 数仓研发的职责以及交付物
1. 数仓研发在了解了业务、业务模型以及数据源定义以后，主要工作就是数仓中间层的设计。中间层的表能在meta.alibaba-inc.com找到定义。同样的这些表缺少表直接关系的定义。数仓同学输出的文档要有中间层表的定义（可以连接到meta.alibaba-inc.com）以及这些表的关系。
2. 另外，数据中间层的设计要符合数据仓库相关的设计规范，比如onedata数据规范



### 数据PD的职责
1. 数据PD参考PD的业务需求以及应用开发提供的业务领域模型,要对数仓中间层的输出做Review,评估数据中间层的定义是不是满足业务需求。



### 工具
2. UML(统一建模语言)。在构建数据中间层的过程中主要使用UML的类图来描述业务领域对象以及对象之间的关联。另外UML也可以用来描述表关系。
1. 文档中心云雀。云雀除了支持文档的编辑以外。还支持在线编辑UML类图。为什么要用“绘图脚本”来绘制UML，而不是把UML类图线下生成以后，再贴到文档中呢？主要是因为线下的UML工具很难实现类似代码一样的同步。云雀支持在线编辑UML图的方式以后，就可以共同编辑UML图，有助于保持文档和实现的同步。
3. Graphviz绘制UML图。在“云雀”里面有两种绘制UML类图的方式一种是PlantUML还有就是Graphviz。PlantUML因为技术原因太大的UML图绘制会失败。graphviz是画图工具，它的输入是一个用dot语言 编写的绘图脚本，通过对输入脚本的解析，分析出其中的点，边以及子图，然后根据属性进行绘制。我们使用Graphviz来绘制UML类图。 [使用Graphviz画UML类图](https://lark.alipay.com/aliyuntrade/architecture/using_graphviz_drawing_uml) 虽然复杂一些，但绘制完整的UML类图不成问题。
